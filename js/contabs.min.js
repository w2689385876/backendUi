$(function() {
  /**
   * @param {?} node
   * @return {?}
   */
  function stop(node) {
    /** @type {number} */
    var e = 0;
    return $(node).each(function() {
      e += $(this).outerWidth(true);
    }), e;
  }
  /**
   * @param {?} node
   * @return {undefined}
   */
  function resize(node) {
    var time = stop($(node).prevAll());
    var myHeight = stop($(node).nextAll());
    var clientTop = stop($(".content-tabs").children().not(".J_menuTabs"));
    /** @type {number} */
    var top = $(".content-tabs").outerWidth(true) - clientTop;
    /** @type {number} */
    var t = 0;
    if ($(".page-tabs-content").outerWidth() < top) {
      /** @type {number} */
      t = 0;
    } else {
      if (myHeight <= top - $(node).outerWidth(true) - $(node).next().outerWidth(true)) {
        if (top - $(node).next().outerWidth(true) > myHeight) {
          t = time;
          var elem = node;
          for (;t - $(elem).outerWidth() > $(".page-tabs-content").outerWidth() - top;) {
            t -= $(elem).prev().outerWidth();
            elem = $(elem).prev();
          }
        }
      } else {
        if (time > top - $(node).outerWidth(true) - $(node).prev().outerWidth(true)) {
          /** @type {number} */
          t = time - $(node).prev().outerWidth(true);
        }
      }
    }
    $(".page-tabs-content").animate({
      marginLeft : 0 - t + "px"
    }, "fast");
  }
  /**
   * @return {?}
   */
  function open() {
    /** @type {number} */
    var viewportBottom = Math.abs(parseInt($(".page-tabs-content").css("margin-left")));
    var time = stop($(".content-tabs").children().not(".J_menuTabs"));
    /** @type {number} */
    var timePassed = $(".content-tabs").outerWidth(true) - time;
    /** @type {number} */
    var size = 0;
    if ($(".page-tabs-content").width() < timePassed) {
      return false;
    }
    var row = $(".J_menuTab:first");
    /** @type {number} */
    var dropTop = 0;
    for (;dropTop + $(row).outerWidth(true) <= viewportBottom;) {
      dropTop += $(row).outerWidth(true);
      row = $(row).next();
    }
    if (dropTop = 0, stop($(row).prevAll()) > timePassed) {
      for (;dropTop + $(row).outerWidth(true) < timePassed && row.length > 0;) {
        dropTop += $(row).outerWidth(true);
        row = $(row).prev();
      }
      size = stop($(row).prevAll());
    }
    $(".page-tabs-content").animate({
      marginLeft : 0 - size + "px"
    }, "fast");
  }
  /**
   * @return {?}
   */
  function toggle() {
    /** @type {number} */
    var viewportBottom = Math.abs(parseInt($(".page-tabs-content").css("margin-left")));
    var time = stop($(".content-tabs").children().not(".J_menuTabs"));
    /** @type {number} */
    var timePassed = $(".content-tabs").outerWidth(true) - time;
    /** @type {number} */
    var size = 0;
    if ($(".page-tabs-content").width() < timePassed) {
      return false;
    }
    var element = $(".J_menuTab:first");
    /** @type {number} */
    var dropTop = 0;
    for (;dropTop + $(element).outerWidth(true) <= viewportBottom;) {
      dropTop += $(element).outerWidth(true);
      element = $(element).next();
    }
    /** @type {number} */
    dropTop = 0;
    for (;dropTop + $(element).outerWidth(true) < timePassed && element.length > 0;) {
      dropTop += $(element).outerWidth(true);
      element = $(element).next();
    }
    size = stop($(element).prevAll());
    if (size > 0) {
      $(".page-tabs-content").animate({
        marginLeft : 0 - size + "px"
      }, "fast");
    }
  }
  /**
   * @return {?}
   */
  function postLink() {
    var id = $(this).attr("href");
    var self = $(this).data("index");
    var i = $.trim($(this).text());
    /** @type {boolean} */
    var n = true;
    if (void 0 == id || 0 == $.trim(id).length) {
      return false;
    }
    if ($(".J_menuTab").each(function() {
      return $(this).data("id") == id ? ($(this).hasClass("active") || ($(this).addClass("active").siblings(".J_menuTab").removeClass("active"), resize(this), $(".J_mainContent .J_iframe").each(function() {
        return $(this).data("id") == id ? ($(this).show().siblings(".J_iframe").hide(), false) : void 0;
      })), n = false, false) : void 0;
    }), n) {
      /** @type {string} */
      var lineSeparator = '<a href="javascript:;" class="active J_menuTab" data-id="' + id + '">' + i + ' <i class="fa fa-times-circle"></i></a>';
      $(".J_menuTab").removeClass("active");
      /** @type {string} */
      var navTabs = '<iframe class="J_iframe" name="iframe' + self + '" width="100%" height="100%" src="' + id + '?v=3.0" frameborder="0" data-id="' + id + '" seamless></iframe>';
      $(".J_mainContent").find("iframe.J_iframe").hide().parents(".J_mainContent").append(navTabs);
      var err = layer.load();
      $(".J_mainContent iframe:visible").load(function() {
        layer.close(err);
      });
      $(".J_menuTabs .page-tabs-content").append(lineSeparator);
      resize($(".J_menuTab.active"));
    }
    return false;
  }
  /**
   * @return {?}
   */
  function start() {
    var id = $(this).parents(".J_menuTab").data("id");
    var delta = $(this).parents(".J_menuTab").width();
    if ($(this).parents(".J_menuTab").hasClass("active")) {
      if ($(this).parents(".J_menuTab").next(".J_menuTab").size()) {
        var element = $(this).parents(".J_menuTab").next(".J_menuTab:eq(0)").data("id");
        $(this).parents(".J_menuTab").next(".J_menuTab:eq(0)").addClass("active");
        $(".J_mainContent .J_iframe").each(function() {
          return $(this).data("id") == element ? ($(this).show().siblings(".J_iframe").hide(), false) : void 0;
        });
        /** @type {number} */
        var current = parseInt($(".page-tabs-content").css("margin-left"));
        if (0 > current) {
          $(".page-tabs-content").animate({
            marginLeft : current + delta + "px"
          }, "fast");
        }
        $(this).parents(".J_menuTab").remove();
        $(".J_mainContent .J_iframe").each(function() {
          return $(this).data("id") == id ? ($(this).remove(), false) : void 0;
        });
      }
      if ($(this).parents(".J_menuTab").prev(".J_menuTab").size()) {
        element = $(this).parents(".J_menuTab").prev(".J_menuTab:last").data("id");
        $(this).parents(".J_menuTab").prev(".J_menuTab:last").addClass("active");
        $(".J_mainContent .J_iframe").each(function() {
          return $(this).data("id") == element ? ($(this).show().siblings(".J_iframe").hide(), false) : void 0;
        });
        $(this).parents(".J_menuTab").remove();
        $(".J_mainContent .J_iframe").each(function() {
          return $(this).data("id") == id ? ($(this).remove(), false) : void 0;
        });
      }
    } else {
      $(this).parents(".J_menuTab").remove();
      $(".J_mainContent .J_iframe").each(function() {
        return $(this).data("id") == id ? ($(this).remove(), false) : void 0;
      });
      resize($(".J_menuTab.active"));
    }
    return false;
  }
  /**
   * @return {undefined}
   */
  function render() {
    $(".page-tabs-content").children("[data-id]").not(":first").not(".active").each(function() {
      $('.J_iframe[data-id="' + $(this).data("id") + '"]').remove();
      $(this).remove();
    });
    $(".page-tabs-content").css("margin-left", "0");
  }
  /**
   * @return {undefined}
   */
  function func() {
    resize($(".J_menuTab.active"));
  }
  /**
   * @return {undefined}
   */
  function init() {
    if (!$(this).hasClass("active")) {
      var id = $(this).data("id");
      $(".J_mainContent .J_iframe").each(function() {
        return $(this).data("id") == id ? ($(this).show().siblings(".J_iframe").hide(), false) : void 0;
      });
      $(this).addClass("active").siblings(".J_menuTab").removeClass("active");
      resize(this);
    }
  }
  /**
   * @return {undefined}
   */
  function handler() {
    var $this = $('.J_iframe[data-id="' + $(this).data("id") + '"]');
    var src = $this.attr("src");
    var err = layer.load();
    $this.attr("src", src).load(function() {
      layer.close(err);
    });
  }
  $(".J_menuItem").each(function(cssText) {
    if (!$(this).attr("data-index")) {
      $(this).attr("data-index", cssText);
    }
  });
  $(".J_menuItem").on("click", postLink);
  $(".J_menuTabs").on("click", ".J_menuTab i", start);
  $(".J_tabCloseOther").on("click", render);
  $(".J_tabShowActive").on("click", func);
  $(".J_menuTabs").on("click", ".J_menuTab", init);
  $(".J_menuTabs").on("dblclick", ".J_menuTab", handler);
  $(".J_tabLeft").on("click", open);
  $(".J_tabRight").on("click", toggle);
  $(".J_tabCloseAll").on("click", function() {
    $(".page-tabs-content").children("[data-id]").not(":first").each(function() {
      $('.J_iframe[data-id="' + $(this).data("id") + '"]').remove();
      $(this).remove();
    });
    $(".page-tabs-content").children("[data-id]:first").each(function() {
      $('.J_iframe[data-id="' + $(this).data("id") + '"]').show();
      $(this).addClass("active");
    });
    $(".page-tabs-content").css("margin-left", "0");
  });
});
